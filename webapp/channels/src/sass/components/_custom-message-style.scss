// Custom message styling for Mattermost
// 客製化訊息樣式

// 1. 自己的訊息在右邊 (Own messages aligned to the right)
.post {
    &.current-user {
        .post__content {
            margin-left: auto;
            margin-right: 0;
            text-align: right;
            max-width: 70%;
            
            .post__body {
                background-color: var(--button-bg);
                color: var(--button-color);
                padding: 8px 12px;
                border-radius: 12px 12px 4px 12px;
                margin-left: auto;
                display: inline-block;
                text-align: left; // Keep text left-aligned within bubble
            }
        }
        
        .post__header {
            justify-content: flex-end;
            text-align: right;
            
            .user-popover {
                order: 2;
            }
            
            .post__time {
                order: 1;
                margin-right: 8px;
                margin-left: 0;
            }
        }
        
        .post__img {
            order: 2;
            margin-left: 8px;
            margin-right: 0;
        }
    }
    
    // 其他人的訊息保持在左邊
    &:not(.current-user) {
        .post__content {
            margin-left: 0;
            margin-right: auto;
            text-align: left;
            
            .post__body {
                background-color: var(--center-channel-bg);
                border: 1px solid var(--center-channel-color-04);
                padding: 8px 12px;
                border-radius: 12px 12px 12px 4px;
            }
        }
    }
}

// 2. 未讀消息置頂 (Unread messages pinned to top)
.sidebar-item {
    &.unread-title {
        position: sticky;
        top: 0;
        z-index: 100;
        background-color: var(--sidebar-bg);
        border-bottom: 1px solid var(--sidebar-text-08);
        
        &::before {
            content: "未讀消息";
            font-size: 11px;
            font-weight: 600;
            color: var(--sidebar-text-60);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 16px 4px;
            display: block;
        }
    }
    
    // 未讀頻道樣式強化
    &.unread {
        background-color: var(--sidebar-text-08);
        border-left: 3px solid var(--button-bg);
        font-weight: 600;
        
        &:hover {
            background-color: var(--sidebar-text-16);
        }
        
        .badge {
            background-color: var(--button-bg);
            color: var(--button-color);
            font-weight: 600;
        }
    }
}

// 3. 文字底框 (Text background/border styling)
.post__body {
    // 基本文字容器樣式
    .markdown__text {
        padding: 2px 4px;
        background-color: rgba(var(--center-channel-color-rgb), 0.04);
        border-radius: 3px;
        border: 1px solid transparent;
        
        // 當有內容時顯示底框
        &:not(:empty) {
            border-color: rgba(var(--center-channel-color-rgb), 0.12);
        }
        
        // 特殊內容類型的樣式
        &.mention-highlight {
            background-color: var(--mention-highlight-bg);
            border-color: var(--mention-highlight-link);
        }
        
        &.search-highlight {
            background-color: var(--search-highlight-bg);
            border-color: var(--search-highlight-border);
        }
    }
    
    // 程式碼區塊樣式
    pre {
        background-color: var(--center-channel-color-08);
        border: 1px solid var(--center-channel-color-16);
        border-radius: 4px;
        padding: 8px;
        
        code {
            background: transparent;
            border: none;
        }
    }
    
    // 行內程式碼樣式
    code:not(pre code) {
        background-color: var(--center-channel-color-08);
        border: 1px solid var(--center-channel-color-16);
        border-radius: 3px;
        padding: 2px 4px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    // 引用樣式
    blockquote {
        border-left: 4px solid var(--center-channel-color-32);
        background-color: var(--center-channel-color-04);
        padding: 8px 16px;
        margin: 8px 0;
        border-radius: 0 4px 4px 0;
    }
}

// 4. 響應式設計調整 (Responsive design adjustments)
@media (max-width: 768px) {
    .post.current-user .post__content {
        max-width: 85%;
    }
    
    .sidebar-item.unread-title::before {
        font-size: 10px;
        padding: 6px 12px 3px;
    }
}

// 5. 深色模式適配 (Dark mode adaptations)
.app__body.theme--dark {
    .post.current-user .post__body {
        background-color: var(--button-bg);
        border-color: var(--button-bg);
    }
    
    .post:not(.current-user) .post__body {
        background-color: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.16);
    }
    
    .sidebar-item.unread {
        background-color: rgba(255, 255, 255, 0.08);
    }
}

// 6. 高對比模式 (High contrast mode)
@media (prefers-contrast: high) {
    .post__body .markdown__text {
        border-color: var(--center-channel-color);
        background-color: var(--center-channel-bg);
    }
    
    .post.current-user .post__body {
        border: 2px solid var(--button-bg);
    }
}